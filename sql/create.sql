DROP TABLE IF EXISTS Order_detail;
DROP TABLE IF EXISTS Cart;
DROP TABLE IF EXISTS Rating;
DROP TABLE IF EXISTS Orders;
DROP TABLE IF EXISTS Product;
DROP TABLE IF EXISTS Normal;
DROP TABLE IF EXISTS User;


CREATE TABLE User (
	userID VARCHAR(20) NOT NULL,
	userName VARCHAR(30) NOT NULL,
	password VARCHAR(30) NOT NULL,
	PRIMARY KEY (userID)
)engine innodb;

CREATE TABLE Normal (
	userID VARCHAR(20) NOT NULL,
	sex INT,
	phone VARCHAR(30) NOT NULL,
	email VARCHAR(30) NOT NULL,
	PRIMARY KEY (userID),
	FOREIGN KEY (userID) REFERENCES User (userID)
	ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE Product (
	PID VARCHAR(20) NOT NULL,
	brand VARCHAR(30) NOT NULL,
	model VARCHAR(30) NOT NULL,
	year DATE NOT NULL,
	color VARCHAR(30) NOT NULL,
	use_time  DECIMAL(2,1) NOT NULL,
	price DECIMAL(20,2) NOT NULL,
	state INT DEFAULT 0,
	image INT NOT NULL,
	sell_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	sellerID VARCHAR(20),
	PRIMARY KEY (PID),
	FOREIGN KEY (sellerID) REFERENCES User (userID)
	ON DELETE SET NULL
);

CREATE TABLE Orders (
	orderID VARCHAR(20) NOT NULL,
	buyerID VARCHAR(20) NOT NULL,
	order_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	ship_address VARCHAR(50) NOT NULL,
	PRIMARY KEY (orderID),
	FOREIGN KEY (buyerID) REFERENCES User (userID)
	ON DELETE NO ACTION
);

CREATE TABLE Rating (
	ratingID VARCHAR(20),
	buyerID VARCHAR(20) NOT NULL,
	sellerID VARCHAR(20) NOT NULL,
	PR_PID VARCHAR(20) NOT NULL,
	rating_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY (ratingID),
	FOREIGN KEY (buyerID) REFERENCES User (userID)
	ON DELETE NO ACTION
);

CREATE TABLE Cart (
	user_cartID VARCHAR(20) NOT NULL,
	cart_PID VARCHAR(20) NOT NULL,
	PRIMARY KEY (user_cartID, cart_PID),
	FOREIGN KEY (user_cartID) REFERENCES User (userID)
	ON DELETE CASCADE,
	FOREIGN KEY (cart_PID) REFERENCES Product (PID)
);

CREATE TABLE Order_detail (
	orderID VARCHAR(20) NOT NULL,
	PID VARCHAR(20) NOT NULL,
	PRIMARY KEY (orderID, PID),
	FOREIGN KEY (orderID) REFERENCES Orders (orderID)
	ON DELETE CASCADE,
	FOREIGN KEY (PID) REFERENCES Product (PID)
);
